import tensorflow as tf
from tensorflow import keras

EPOCHS = 20
BATCH_SIZE = 512
VERBOSE = 1
NB_CLASSES = 10
N_HIDDEN = 128
VALIDATION_SPLIT=0.2
DROPOUT = 0.3

mnist = keras.datasets.mnist

(X_train, Y_train), (X_test, Y_test) = mnist.load_data()

RESHAPED = 784

X_train = X_train.reshape(60000, RESHAPED)
X_test = X_test.reshape(10000, RESHAPED)
X_train = X_train.astype('float32')
X_test = X_test.astype('float32')

X_train, X_test = X_train / 255.0, X_test / 255.0

print(X_train.shape[0], 'train samples')
print(X_test.shape[0], 'test samples')
'''
60000 train samples
10000 test samples
'''

Y_train = tf.keras.utils.to_categorical(Y_train, NB_CLASSES)
Y_test = tf.keras.utils.to_categorical(Y_test, NB_CLASSES)

model = tf.keras.models.Sequential()
model.add(keras.layers.Dense(N_HIDDEN, input_shape=(RESHAPED,), name='dense_layer', activation='relu'))
model.add(keras.layers.Dropout(DROPOUT))
model.add(keras.layers.Dense(N_HIDDEN, name='dense_layer_2', activation='relu'))
model.add(keras.layers.Dropout(DROPOUT))
model.add(keras.layers.Dense(NB_CLASSES, name='dense_layer_3', activation='softmax'))

model.summary()
'''
Model: "sequential"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
dense_layer (Dense)          (None, 128)               100480    
_________________________________________________________________
dropout (Dropout)            (None, 128)               0         
_________________________________________________________________
dense_layer_2 (Dense)        (None, 128)               16512     
_________________________________________________________________
dropout_1 (Dropout)          (None, 128)               0         
_________________________________________________________________
dense_layer_3 (Dense)        (None, 10)                1290      
=================================================================
Total params: 118,282
Trainable params: 118,282
Non-trainable params: 0
_________________________________________________________________
Train on 48000 samples, validate on 12000 samples
'''

model.compile(optimizer='Adam', loss='categorical_crossentropy', metrics=['accuracy'])

model.fit(X_train, Y_train, batch_size=BATCH_SIZE, epochs=EPOCHS,
		  verbose=VERBOSE, validation_split=VALIDATION_SPLIT)

test_loss, test_acc = model.evaluate(X_test, Y_test)

print('Test accuracy:', test_acc)
'''Test accuracy: 0.9781'''

predictions = model.predict(X_test)

'''
Epoch 1/20

  512/48000 [..............................] - ETA: 20s - loss: 2.4036 - accuracy: 0.0879
 6656/48000 [===>..........................] - ETA: 1s - loss: 1.9649 - accuracy: 0.3661 
12800/48000 [=======>......................] - ETA: 0s - loss: 1.5880 - accuracy: 0.5060
18944/48000 [==========>...................] - ETA: 0s - loss: 1.3316 - accuracy: 0.5833
25088/48000 [==============>...............] - ETA: 0s - loss: 1.1553 - accuracy: 0.6395
30720/48000 [==================>...........] - ETA: 0s - loss: 1.0428 - accuracy: 0.6766
36864/48000 [======================>.......] - ETA: 0s - loss: 0.9496 - accuracy: 0.7060
43008/48000 [=========================>....] - ETA: 0s - loss: 0.8767 - accuracy: 0.7291
48000/48000 [==============================] - 1s 15us/sample - loss: 0.8290 - accuracy: 0.7440 - val_loss: 0.2677 - val_accuracy: 0.9212
Epoch 2/20

  512/48000 [..............................] - ETA: 0s - loss: 0.3304 - accuracy: 0.9062
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.3665 - accuracy: 0.8950
12800/48000 [=======>......................] - ETA: 0s - loss: 0.3724 - accuracy: 0.8919
18944/48000 [==========>...................] - ETA: 0s - loss: 0.3601 - accuracy: 0.8959
25088/48000 [==============>...............] - ETA: 0s - loss: 0.3514 - accuracy: 0.8992
31232/48000 [==================>...........] - ETA: 0s - loss: 0.3504 - accuracy: 0.8996
37376/48000 [======================>.......] - ETA: 0s - loss: 0.3419 - accuracy: 0.9016
43520/48000 [==========================>...] - ETA: 0s - loss: 0.3346 - accuracy: 0.9037
48000/48000 [==============================] - 0s 10us/sample - loss: 0.3280 - accuracy: 0.9058 - val_loss: 0.1894 - val_accuracy: 0.9459
Epoch 3/20

  512/48000 [..............................] - ETA: 0s - loss: 0.2434 - accuracy: 0.9199
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.2830 - accuracy: 0.9163
12800/48000 [=======>......................] - ETA: 0s - loss: 0.2786 - accuracy: 0.9179
18944/48000 [==========>...................] - ETA: 0s - loss: 0.2725 - accuracy: 0.9203
25088/48000 [==============>...............] - ETA: 0s - loss: 0.2665 - accuracy: 0.9216
30720/48000 [==================>...........] - ETA: 0s - loss: 0.2617 - accuracy: 0.9233
36864/48000 [======================>.......] - ETA: 0s - loss: 0.2573 - accuracy: 0.9249
43008/48000 [=========================>....] - ETA: 0s - loss: 0.2578 - accuracy: 0.9248
48000/48000 [==============================] - 0s 10us/sample - loss: 0.2542 - accuracy: 0.9256 - val_loss: 0.1580 - val_accuracy: 0.9557
Epoch 4/20

  512/48000 [..............................] - ETA: 0s - loss: 0.1597 - accuracy: 0.9629
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.2108 - accuracy: 0.9396
12800/48000 [=======>......................] - ETA: 0s - loss: 0.2128 - accuracy: 0.9366
18944/48000 [==========>...................] - ETA: 0s - loss: 0.2151 - accuracy: 0.9364
25088/48000 [==============>...............] - ETA: 0s - loss: 0.2157 - accuracy: 0.9364
31232/48000 [==================>...........] - ETA: 0s - loss: 0.2146 - accuracy: 0.9363
37376/48000 [======================>.......] - ETA: 0s - loss: 0.2111 - accuracy: 0.9370
43520/48000 [==========================>...] - ETA: 0s - loss: 0.2094 - accuracy: 0.9376
48000/48000 [==============================] - 0s 10us/sample - loss: 0.2091 - accuracy: 0.9379 - val_loss: 0.1388 - val_accuracy: 0.9608
Epoch 5/20

  512/48000 [..............................] - ETA: 0s - loss: 0.2031 - accuracy: 0.9395
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.1785 - accuracy: 0.9483
12800/48000 [=======>......................] - ETA: 0s - loss: 0.1808 - accuracy: 0.9459
18944/48000 [==========>...................] - ETA: 0s - loss: 0.1877 - accuracy: 0.9445
25088/48000 [==============>...............] - ETA: 0s - loss: 0.1872 - accuracy: 0.9454
31232/48000 [==================>...........] - ETA: 0s - loss: 0.1857 - accuracy: 0.9457
37376/48000 [======================>.......] - ETA: 0s - loss: 0.1846 - accuracy: 0.9458
43520/48000 [==========================>...] - ETA: 0s - loss: 0.1820 - accuracy: 0.9466
48000/48000 [==============================] - 0s 10us/sample - loss: 0.1810 - accuracy: 0.9472 - val_loss: 0.1275 - val_accuracy: 0.9625
Epoch 6/20

  512/48000 [..............................] - ETA: 0s - loss: 0.1302 - accuracy: 0.9570
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.1689 - accuracy: 0.9510
12800/48000 [=======>......................] - ETA: 0s - loss: 0.1646 - accuracy: 0.9496
18944/48000 [==========>...................] - ETA: 0s - loss: 0.1636 - accuracy: 0.9498
25088/48000 [==============>...............] - ETA: 0s - loss: 0.1629 - accuracy: 0.9509
31232/48000 [==================>...........] - ETA: 0s - loss: 0.1622 - accuracy: 0.9514
37376/48000 [======================>.......] - ETA: 0s - loss: 0.1625 - accuracy: 0.9513
43520/48000 [==========================>...] - ETA: 0s - loss: 0.1616 - accuracy: 0.9514
48000/48000 [==============================] - 0s 10us/sample - loss: 0.1615 - accuracy: 0.9513 - val_loss: 0.1204 - val_accuracy: 0.9647
Epoch 7/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0732 - accuracy: 0.9766
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.1570 - accuracy: 0.9539
12800/48000 [=======>......................] - ETA: 0s - loss: 0.1544 - accuracy: 0.9538
18944/48000 [==========>...................] - ETA: 0s - loss: 0.1541 - accuracy: 0.9542
25088/48000 [==============>...............] - ETA: 0s - loss: 0.1507 - accuracy: 0.9552
31232/48000 [==================>...........] - ETA: 0s - loss: 0.1482 - accuracy: 0.9558
37376/48000 [======================>.......] - ETA: 0s - loss: 0.1483 - accuracy: 0.9562
43520/48000 [==========================>...] - ETA: 0s - loss: 0.1484 - accuracy: 0.9562
48000/48000 [==============================] - 0s 10us/sample - loss: 0.1475 - accuracy: 0.9563 - val_loss: 0.1092 - val_accuracy: 0.9678
Epoch 8/20

  512/48000 [..............................] - ETA: 0s - loss: 0.1251 - accuracy: 0.9629
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.1257 - accuracy: 0.9636
12800/48000 [=======>......................] - ETA: 0s - loss: 0.1331 - accuracy: 0.9611
18944/48000 [==========>...................] - ETA: 0s - loss: 0.1358 - accuracy: 0.9598
25088/48000 [==============>...............] - ETA: 0s - loss: 0.1369 - accuracy: 0.9587
31232/48000 [==================>...........] - ETA: 0s - loss: 0.1356 - accuracy: 0.9592
37376/48000 [======================>.......] - ETA: 0s - loss: 0.1358 - accuracy: 0.9594
43008/48000 [=========================>....] - ETA: 0s - loss: 0.1335 - accuracy: 0.9601
48000/48000 [==============================] - 0s 10us/sample - loss: 0.1335 - accuracy: 0.9601 - val_loss: 0.1042 - val_accuracy: 0.9694
Epoch 9/20

  512/48000 [..............................] - ETA: 0s - loss: 0.1372 - accuracy: 0.9629
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.1348 - accuracy: 0.9576
12800/48000 [=======>......................] - ETA: 0s - loss: 0.1251 - accuracy: 0.9627
18944/48000 [==========>...................] - ETA: 0s - loss: 0.1225 - accuracy: 0.9627
25088/48000 [==============>...............] - ETA: 0s - loss: 0.1199 - accuracy: 0.9634
31232/48000 [==================>...........] - ETA: 0s - loss: 0.1216 - accuracy: 0.9627
37376/48000 [======================>.......] - ETA: 0s - loss: 0.1213 - accuracy: 0.9632
43520/48000 [==========================>...] - ETA: 0s - loss: 0.1220 - accuracy: 0.9630
48000/48000 [==============================] - 0s 10us/sample - loss: 0.1228 - accuracy: 0.9628 - val_loss: 0.1011 - val_accuracy: 0.9710
Epoch 10/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0936 - accuracy: 0.9707
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.1203 - accuracy: 0.9638
12800/48000 [=======>......................] - ETA: 0s - loss: 0.1094 - accuracy: 0.9670
18944/48000 [==========>...................] - ETA: 0s - loss: 0.1099 - accuracy: 0.9670
25088/48000 [==============>...............] - ETA: 0s - loss: 0.1094 - accuracy: 0.9667
31232/48000 [==================>...........] - ETA: 0s - loss: 0.1101 - accuracy: 0.9667
37376/48000 [======================>.......] - ETA: 0s - loss: 0.1110 - accuracy: 0.9663
43520/48000 [==========================>...] - ETA: 0s - loss: 0.1109 - accuracy: 0.9666
48000/48000 [==============================] - 0s 10us/sample - loss: 0.1113 - accuracy: 0.9667 - val_loss: 0.0959 - val_accuracy: 0.9724
Epoch 11/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0820 - accuracy: 0.9746
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.1098 - accuracy: 0.9677
12800/48000 [=======>......................] - ETA: 0s - loss: 0.1067 - accuracy: 0.9684
18944/48000 [==========>...................] - ETA: 0s - loss: 0.1091 - accuracy: 0.9666
25088/48000 [==============>...............] - ETA: 0s - loss: 0.1107 - accuracy: 0.9663
31232/48000 [==================>...........] - ETA: 0s - loss: 0.1108 - accuracy: 0.9671
37376/48000 [======================>.......] - ETA: 0s - loss: 0.1103 - accuracy: 0.9675
43520/48000 [==========================>...] - ETA: 0s - loss: 0.1093 - accuracy: 0.9677
48000/48000 [==============================] - 0s 10us/sample - loss: 0.1084 - accuracy: 0.9679 - val_loss: 0.0939 - val_accuracy: 0.9728
Epoch 12/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0964 - accuracy: 0.9609
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.0977 - accuracy: 0.9715
12800/48000 [=======>......................] - ETA: 0s - loss: 0.0999 - accuracy: 0.9706
18944/48000 [==========>...................] - ETA: 0s - loss: 0.0976 - accuracy: 0.9708
25088/48000 [==============>...............] - ETA: 0s - loss: 0.0981 - accuracy: 0.9703
31232/48000 [==================>...........] - ETA: 0s - loss: 0.0986 - accuracy: 0.9702
37376/48000 [======================>.......] - ETA: 0s - loss: 0.0978 - accuracy: 0.9703
43520/48000 [==========================>...] - ETA: 0s - loss: 0.0981 - accuracy: 0.9703
48000/48000 [==============================] - 0s 10us/sample - loss: 0.0988 - accuracy: 0.9701 - val_loss: 0.0892 - val_accuracy: 0.9737
Epoch 13/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0688 - accuracy: 0.9805
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.0903 - accuracy: 0.9727
12800/48000 [=======>......................] - ETA: 0s - loss: 0.0887 - accuracy: 0.9727
18944/48000 [==========>...................] - ETA: 0s - loss: 0.0896 - accuracy: 0.9723
25088/48000 [==============>...............] - ETA: 0s - loss: 0.0923 - accuracy: 0.9721
31232/48000 [==================>...........] - ETA: 0s - loss: 0.0901 - accuracy: 0.9724
37376/48000 [======================>.......] - ETA: 0s - loss: 0.0925 - accuracy: 0.9717
43520/48000 [==========================>...] - ETA: 0s - loss: 0.0922 - accuracy: 0.9716
48000/48000 [==============================] - 0s 10us/sample - loss: 0.0930 - accuracy: 0.9713 - val_loss: 0.0858 - val_accuracy: 0.9747
Epoch 14/20

  512/48000 [..............................] - ETA: 0s - loss: 0.1075 - accuracy: 0.9688
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.0919 - accuracy: 0.9715
12800/48000 [=======>......................] - ETA: 0s - loss: 0.0889 - accuracy: 0.9733
18944/48000 [==========>...................] - ETA: 0s - loss: 0.0924 - accuracy: 0.9727
25088/48000 [==============>...............] - ETA: 0s - loss: 0.0914 - accuracy: 0.9722
31232/48000 [==================>...........] - ETA: 0s - loss: 0.0908 - accuracy: 0.9720
37376/48000 [======================>.......] - ETA: 0s - loss: 0.0899 - accuracy: 0.9721
43520/48000 [==========================>...] - ETA: 0s - loss: 0.0893 - accuracy: 0.9725
48000/48000 [==============================] - 0s 10us/sample - loss: 0.0894 - accuracy: 0.9728 - val_loss: 0.0863 - val_accuracy: 0.9750
Epoch 15/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0896 - accuracy: 0.9648
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.0904 - accuracy: 0.9725
12800/48000 [=======>......................] - ETA: 0s - loss: 0.0878 - accuracy: 0.9730
18944/48000 [==========>...................] - ETA: 0s - loss: 0.0849 - accuracy: 0.9734
25088/48000 [==============>...............] - ETA: 0s - loss: 0.0834 - accuracy: 0.9742
31232/48000 [==================>...........] - ETA: 0s - loss: 0.0835 - accuracy: 0.9742
37376/48000 [======================>.......] - ETA: 0s - loss: 0.0833 - accuracy: 0.9743
43008/48000 [=========================>....] - ETA: 0s - loss: 0.0825 - accuracy: 0.9744
48000/48000 [==============================] - 0s 10us/sample - loss: 0.0827 - accuracy: 0.9743 - val_loss: 0.0858 - val_accuracy: 0.9759
Epoch 16/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0682 - accuracy: 0.9746
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.0774 - accuracy: 0.9742
12288/48000 [======>.......................] - ETA: 0s - loss: 0.0752 - accuracy: 0.9763
17920/48000 [==========>...................] - ETA: 0s - loss: 0.0771 - accuracy: 0.9756
23552/48000 [=============>................] - ETA: 0s - loss: 0.0784 - accuracy: 0.9759
29184/48000 [=================>............] - ETA: 0s - loss: 0.0780 - accuracy: 0.9756
34816/48000 [====================>.........] - ETA: 0s - loss: 0.0801 - accuracy: 0.9750
40448/48000 [========================>.....] - ETA: 0s - loss: 0.0801 - accuracy: 0.9753
46592/48000 [============================>.] - ETA: 0s - loss: 0.0810 - accuracy: 0.9750
48000/48000 [==============================] - 0s 10us/sample - loss: 0.0809 - accuracy: 0.9749 - val_loss: 0.0823 - val_accuracy: 0.9754
Epoch 17/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0607 - accuracy: 0.9863
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.0750 - accuracy: 0.9775
12800/48000 [=======>......................] - ETA: 0s - loss: 0.0731 - accuracy: 0.9773
18944/48000 [==========>...................] - ETA: 0s - loss: 0.0746 - accuracy: 0.9772
25088/48000 [==============>...............] - ETA: 0s - loss: 0.0769 - accuracy: 0.9764
31232/48000 [==================>...........] - ETA: 0s - loss: 0.0758 - accuracy: 0.9770
37376/48000 [======================>.......] - ETA: 0s - loss: 0.0760 - accuracy: 0.9768
43520/48000 [==========================>...] - ETA: 0s - loss: 0.0765 - accuracy: 0.9764
48000/48000 [==============================] - 0s 10us/sample - loss: 0.0759 - accuracy: 0.9766 - val_loss: 0.0844 - val_accuracy: 0.9761
Epoch 18/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0613 - accuracy: 0.9844
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.0690 - accuracy: 0.9793
12800/48000 [=======>......................] - ETA: 0s - loss: 0.0700 - accuracy: 0.9780
18944/48000 [==========>...................] - ETA: 0s - loss: 0.0742 - accuracy: 0.9764
25088/48000 [==============>...............] - ETA: 0s - loss: 0.0732 - accuracy: 0.9767
31232/48000 [==================>...........] - ETA: 0s - loss: 0.0736 - accuracy: 0.9764
37376/48000 [======================>.......] - ETA: 0s - loss: 0.0747 - accuracy: 0.9764
43520/48000 [==========================>...] - ETA: 0s - loss: 0.0741 - accuracy: 0.9764
48000/48000 [==============================] - 0s 10us/sample - loss: 0.0744 - accuracy: 0.9764 - val_loss: 0.0840 - val_accuracy: 0.9764
Epoch 19/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0420 - accuracy: 0.9844
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.0634 - accuracy: 0.9793
12800/48000 [=======>......................] - ETA: 0s - loss: 0.0653 - accuracy: 0.9798
18944/48000 [==========>...................] - ETA: 0s - loss: 0.0672 - accuracy: 0.9787
25088/48000 [==============>...............] - ETA: 0s - loss: 0.0694 - accuracy: 0.9783
31232/48000 [==================>...........] - ETA: 0s - loss: 0.0703 - accuracy: 0.9780
36864/48000 [======================>.......] - ETA: 0s - loss: 0.0702 - accuracy: 0.9780
42496/48000 [=========================>....] - ETA: 0s - loss: 0.0700 - accuracy: 0.9777
48000/48000 [==============================] - 0s 10us/sample - loss: 0.0705 - accuracy: 0.9775 - val_loss: 0.0840 - val_accuracy: 0.9767
Epoch 20/20

  512/48000 [..............................] - ETA: 0s - loss: 0.0799 - accuracy: 0.9785
 6656/48000 [===>..........................] - ETA: 0s - loss: 0.0720 - accuracy: 0.9788
12800/48000 [=======>......................] - ETA: 0s - loss: 0.0666 - accuracy: 0.9791
18944/48000 [==========>...................] - ETA: 0s - loss: 0.0687 - accuracy: 0.9780
25088/48000 [==============>...............] - ETA: 0s - loss: 0.0711 - accuracy: 0.9774
31232/48000 [==================>...........] - ETA: 0s - loss: 0.0716 - accuracy: 0.9771
36864/48000 [======================>.......] - ETA: 0s - loss: 0.0706 - accuracy: 0.9775
43008/48000 [=========================>....] - ETA: 0s - loss: 0.0700 - accuracy: 0.9776
48000/48000 [==============================] - 0s 10us/sample - loss: 0.0698 - accuracy: 0.9778 - val_loss: 0.0803 - val_accuracy: 0.9781

   32/10000 [..............................] - ETA: 0s - loss: 0.0515 - accuracy: 0.9688
 3072/10000 [========>.....................] - ETA: 0s - loss: 0.1047 - accuracy: 0.9668
 6144/10000 [=================>............] - ETA: 0s - loss: 0.0927 - accuracy: 0.9728
 9312/10000 [==========================>...] - ETA: 0s - loss: 0.0753 - accuracy: 0.9781
10000/10000 [==============================] - 0s 16us/sample - loss: 0.0766 - accuracy: 0.9781
'''